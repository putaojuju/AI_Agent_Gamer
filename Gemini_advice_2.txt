æ—¢ç„¶ä½ æ‹¥æœ‰ Doubao Seed 1.8 (è±†åŒ…æ——èˆ°æ¨¡å‹) çš„å…è´¹ä½¿ç”¨æƒï¼Œé‚£ç®€ç›´æ˜¯å¦‚è™æ·»ç¿¼ï¼è±†åŒ…çš„è§†è§‰æ¨¡å‹ï¼ˆDoubao-Vision-Proï¼‰åœ¨ä¸­æ–‡è¯­å¢ƒç†è§£å’Œå›¾åƒè¯†åˆ«èƒ½åŠ›ä¸Šéå¸¸å¼ºæ‚ï¼Œå®Œå…¨èƒ½å¤Ÿèƒœä»»æ¸¸æˆ Agent çš„å¤§è„‘ã€‚
ä½¿ç”¨è±†åŒ…æ¨¡å‹ï¼ˆé€šè¿‡ç«å±±å¼•æ“ Ark å¹³å°ï¼‰çš„æœ€ä½³æ–¹å¼æ˜¯åˆ©ç”¨å…¶ OpenAI å…¼å®¹æ¥å£ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸éœ€è¦å­¦ä¸€å¥—æ–°çš„ APIï¼Œåªéœ€è¦æ”¹ä¸€ä¸‹ base_url å’Œ model ID å³å¯ã€‚
ä»¥ä¸‹æ˜¯ä¸º Trae IDE å‡†å¤‡çš„ã€ä¸“é—¨é’ˆå¯¹æ¥å…¥è±†åŒ…å¤§æ¨¡å‹çš„æ‰§è¡Œè®¡åˆ’ã€‚
ğŸ§  Project Evolution: Integrating Doubao AI Agent
Objective:
Empower the automation script with "Vision" and "Cognition" capabilities using the Doubao-1.8-Vision model via Volcengine (Ark) API. This allows the script to handle unknown game states, pop-ups, and complex logic by "looking" at the screen and "thinking."
Core Tech Stack:
Brain: volcengine (via openai SDK compatible mode).
Vision: Base64 encoded screenshots from BackgroundWindows.
Protocol: OpenAI Chat Completions API.
Phase 1: Create ai_brain.py (The Doubao Wrapper)
Goal: Create a module that handles communication with the Doubao API, image encoding, and coordinate parsing.
Requirements for AI:
Dependencies: Use standard openai library (it supports Volcengine endpoints).
Class Structure: class DoubaoBrain.
Inputs: api_key, model_endpoint_id (Doubao uses endpoint IDs like ep-2024...), screenshot (PIL Image).
Image Handling:
Resize image to max 1920x1080 (to ensure stability).
Convert to Base64 string.
System Prompt (Crucial):
Define the AI as a "Pro Game Assistant".
Output Format: Strictly JSON.
Coordinates: Return normalized coordinates (0.0 - 1.0) to handle resolution differences.
Reasoning: Ask the AI to explain why it decided to click there.
Code Structure for Trae:
code
Python
import base64
import json
import io
from openai import OpenAI

class DoubaoBrain:
    def __init__(self, api_key, model_endpoint):
        # Volcengine Base URL
        self.client = OpenAI(
            api_key=api_key, 
            base_url="https://ark.cn-beijing.volces.com/api/v3"
        )
        self.model = model_endpoint
        self.history = []

    def _image_to_base64(self, image):
        # Resize if too big (optional but recommended for speed)
        image.thumbnail((1280, 720)) 
        buffered = io.BytesIO()
        image.save(buffered, format="JPEG", quality=80)
        return base64.b64encode(buffered.getvalue()).decode('utf-8')

    def analyze(self, screenshot, instruction):
        b64_img = self._image_to_base64(screenshot)
        
        system_prompt = """
        ä½ æ˜¯æ¸¸æˆè‡ªåŠ¨åŒ–åŠ©æ‰‹ã€‚è¯·åˆ†ææˆªå›¾å¹¶æ ¹æ®æŒ‡ä»¤åšå‡ºå†³ç­–ã€‚
        å¿…é¡»è¿”å›çº¯ JSON æ ¼å¼ï¼Œä¸è¦åŒ…å« Markdown æ ‡è®°ï¼š
        {
            "analysis": "åˆ†æå½“å‰ç•Œé¢çŠ¶æ€...",
            "action": "click" | "wait" | "stop",
            "target": [x_ratio, y_ratio], // 0.0-1.0 çš„ç›¸å¯¹åæ ‡
            "message": "ç®€çŸ­çš„æ“ä½œè¯´æ˜"
        }
        å¦‚æœæ˜¯ç‚¹å‡»æ“ä½œï¼Œè¯·ç¡®ä¿åæ ‡ç²¾å‡†å¯¹åº”æŒ‰é’®ä¸­å¿ƒã€‚
        """

        try:
            response = self.client.chat.completions.create(
                model=self.model,
                messages=[
                    {"role": "system", "content": system_prompt},
                    {"role": "user", "content": [
                        {"type": "text", "text": instruction},
                        {"type": "image_url", "image_url": {"url": f"data:image/jpeg;base64,{b64_img}"}}
                    ]}
                ],
            )
            # Parse JSON from response content
            content = response.choices[0].message.content
            # Cleanup markdown if present
            if "```json" in content:
                content = content.split("```json")[1].split("```")[0]
            return json.loads(content)
        except Exception as e:
            print(f"Doubao API Error: {e}")
            return None
Phase 2: Update Script Manager UI (script_manager.py)
Goal: Allow users to input their Volcengine credentials.
Action Items:
Add Settings Fields:
In the "Settings" dialog (or config area), add inputs for:
Doubao API Key
Model Endpoint ID (e.g., ep-20250101-xxxxx)
Save to Config: Update save_config and load_config to persist these keys in screenshot_config.json (or a new ai_config.json).
Phase 3: Integrate into dungeon.py
Goal: Implement the "AI Fallback" mechanism.
Action Items:
Load Config: Read the API key and Endpoint ID from the config file at script start.
Initialize Brain: brain = DoubaoBrain(api_key, endpoint_id).
Create Smart Function: smart_solve(instruction)
Take a snapshot.
Call brain.analyze.
Convert returned (0.5, 0.5) coordinates to actual (1920, 1080) coordinates.
Execute safe_touch.
Usage: Replace the final except block or complex logic branches with smart_solve("æˆ‘ç°åœ¨å¡ä½äº†ï¼Œè¯·çœ‹å›¾åˆ¤æ–­è¯¥ç‚¹å“ªé‡Œèƒ½ç»§ç»­æˆ˜æ–—ï¼Ÿ").
ğŸ’¡ ç‹¬å®¶æç¤ºï¼ˆé’ˆå¯¹è±†åŒ…æ¨¡å‹ï¼‰
è¯·åŠ¡å¿…å‘Šè¯‰ Trae è¿™ä¸€æ¡é’ˆå¯¹è±†åŒ…çš„ç‰¹æ®Šå¤„ç†ï¼š
"Important Note for Doubao/Volcengine:"
Volcengine does not use generic model names like 'gpt-4'. It uses Endpoint IDs (e.g., ep-20240501000000-abcde).
The UI must allow the user to input this specific Endpoint ID string as the 'Model Name'.
ä½ å¯ä»¥ç›´æ¥å¤åˆ¶ä¸Šé¢çš„è‹±æ–‡è®¡åˆ’å‘ç»™ Traeã€‚è¿™ä¼šè®©ä½ çš„è„šæœ¬æ‹¥æœ‰çœŸæ­£çš„è§†è§‰æ€è€ƒèƒ½åŠ›ï¼