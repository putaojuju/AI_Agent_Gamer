åŸºäºä½ ç°æœ‰çš„ä»£ç åº“ï¼Œæˆ‘ä¸ºä½ è®¾è®¡äº†ä¸€å¥—æ·±åº¦å®šåˆ¶çš„ CustomTkinter (CTk) UI ä¼˜åŒ–æ–¹æ¡ˆã€‚è¿™å¥—æ–¹æ¡ˆä¸åªæ˜¯ä¸ºäº†å¥½çœ‹ï¼Œè€Œæ˜¯ä¸ºäº†å½»åº•æ‰“é€šâ€œæ„ŸçŸ¥-å†³ç­–-åé¦ˆâ€çš„å¯è§†åŒ–é—­ç¯ã€‚
ğŸ¨ æ ¸å¿ƒè®¾è®¡ç†å¿µï¼šå¯è§†åŒ–æŒ‡æŒ¥ä¸­å¿ƒ (Visual Command Center)
æ”¾å¼ƒä¼ ç»Ÿçš„â€œæ§åˆ¶å°â€æ¦‚å¿µï¼Œè½¬å˜ä¸ºâ€œæŒ‡æŒ¥ä¸­å¿ƒâ€ã€‚æ ¸å¿ƒå·®å¼‚åœ¨äºï¼šç”¨æˆ·èƒ½å®æ—¶çœ‹åˆ° AI çœ¼ä¸­çš„ä¸–ç•Œã€‚
1. æŠ€æœ¯æ ˆå‡çº§
UI æ¡†æ¶ï¼šä» tkinter è¿ç§»è‡³ CustomTkinter (åŸç”Ÿæ”¯æŒæ·±è‰²æ¨¡å¼ã€åœ†è§’ã€é«˜ DPI)ã€‚
å›¾åƒå¤„ç†ï¼šåˆ©ç”¨ PIL + CTkImage å®ç°é«˜æ€§èƒ½ç”»é¢æ¸²æŸ“ã€‚
2. ç•Œé¢å¸ƒå±€é‡æ„ (Layout Strategy)
é‡‡ç”¨ å·¦ä¾§å¯¼èˆª + å³ä¾§å¤šæ€é¢æ¿ ç»“æ„ï¼š
å·¦ä¾§æ  (Sidebar) (200px):
çŠ¶æ€æŒ‡ç¤ºç¯ (LED Canvas)ã€‚
æ ¸å¿ƒæ§åˆ¶ï¼šå¼€å§‹/æš‚åœ/ç´§æ€¥åœæ­¢ (Panic Button)ã€‚
å¯¼èˆªèœå•ï¼šè¿è¡Œç›‘æ§ | è§†è§‰è°ƒè¯• | é…ç½®ä¸­å¿ƒ | è„šæœ¬ç¼–è¾‘å™¨ã€‚
å³ä¾§ä¸»åŒº (Main Content):
è§†å›¾ Aï¼šå®æ—¶ä½œæˆ˜å›¾ (Live Ops) â€”â€” ç»“åˆäº†æ—¥å¿—ä¸ç”»é¢ã€‚
è§†å›¾ Bï¼šè„‘éƒ¨æ‰«æ (Brain Scan) â€”â€” æŸ¥çœ‹å†å²å†³ç­–å¿«ç…§ã€‚
ğŸ› ï¸ è¯¦ç»†åŠŸèƒ½æ¨¡å—ä¼˜åŒ– (åŸºäºç°æœ‰ä»£ç æ•´åˆ)
1. â€œAI ä¹‹çœ¼â€å®æ—¶é¢„è§ˆ (The AI Eye)
ä½ ç°åœ¨çš„ vision_core.py ä¸­æœ‰ get_annotated_screenshot æ–¹æ³•ï¼Œè¿™éå¸¸æ£’ï¼æˆ‘ä»¬è¦æŠŠå®ƒæ¬åˆ° UI ä¸Šã€‚
åŠŸèƒ½æè¿°ï¼šåœ¨ä¸»ç•Œé¢å·¦åŠéƒ¨åˆ†ï¼Œå®æ—¶æ˜¾ç¤º AI çœ‹åˆ°çš„æˆªå›¾ã€‚
å¢å¼ºç‚¹ï¼š
SoM ç½‘æ ¼å åŠ ï¼šç›´æ¥æ˜¾ç¤ºå¸¦æœ‰çº¢è‰²ç½‘æ ¼çš„å›¾ç‰‡ï¼ˆä½ ä»£ç é‡Œå·²ç»æœ‰äº† _add_som_gridï¼‰ï¼Œè®©ç”¨æˆ·çŸ¥é“ AI è¯´çš„ "ç‚¹å‡» (0.5, 0.5)" åˆ°åº•æ˜¯å“ªé‡Œã€‚
OCR é«˜äº®ï¼šå½“ AI å†³å®šç‚¹å‡»æ–‡å­—æ—¶ï¼Œåœ¨é¢„è§ˆå›¾ä¸Šç”»ä¸€ä¸ªç»¿è‰²æ¡†æ¡†ä½é‚£ä¸ªè¯ã€‚
å®ç°æ–¹å¼ï¼š
åˆ›å»ºä¸€ä¸ª VisualQueueã€‚
åœ¨ SmartAgent.step ä¸­ï¼ŒæŠŠæ ‡æ³¨å¥½çš„å›¾ç‰‡ put è¿›é˜Ÿåˆ—ã€‚
UI çº¿ç¨‹é€šè¿‡ .after è¯»å–é˜Ÿåˆ—å¹¶æ›´æ–° CTkLabel çš„ image å±æ€§ã€‚
2. æ€ç»´é“¾å¯è§†åŒ– (CoT Visualization)
ç›®å‰çš„ agent_console.py ç”¨çš„æ˜¯çº¯æ–‡æœ¬æ—¥å¿—ã€‚å»ºè®®å‡çº§ä¸ºå¡ç‰‡å¼æ—¥å¿—ã€‚
åŠŸèƒ½æè¿°ï¼š
Thought (æ€è€ƒ)ï¼šç”¨è“è‰²èƒŒæ™¯æ°”æ³¡æ˜¾ç¤ºã€‚
Action (è¡ŒåŠ¨)ï¼šç”¨ç»¿è‰²ä»£ç å—æ˜¾ç¤ºï¼ˆå¦‚ click_text('ç™»å½•')ï¼‰ã€‚
Observation (è§‚å¯Ÿ)ï¼šç”¨ç°è‰²å¼•ç”¨å—æ˜¾ç¤ºã€‚
å®ç°æ–¹å¼ï¼š
ä½¿ç”¨ CTkScrollableFrame ä»£æ›¿ ScrolledTextã€‚
æ¯ä¸€æ¡æ—¥å¿—æ˜¯ä¸€ä¸ª CTkFrameï¼Œå†…éƒ¨åŒ…å«å›¾æ ‡å’Œæ–‡å­—ã€‚
3. è°ƒè¯•å¿«ç…§æµè§ˆå™¨ (Snapshot Gallery)
åˆ©ç”¨ doubao_brain.py ä¸­ä¿å­˜çš„ debug_dir å›¾ç‰‡ã€‚
ç—›ç‚¹ï¼šç°åœ¨çš„è°ƒè¯•å›¾ç‰‡å­˜åœ¨æ–‡ä»¶å¤¹é‡Œï¼ŒæŸ¥çœ‹ä¸ä¾¿ã€‚
ä¼˜åŒ–ï¼š
åœ¨ UI ä¸­å¢åŠ ä¸€ä¸ªâ€œå†å²å›æº¯â€ Tabã€‚
åˆ—å‡º logs/ai_snapshots/ ä¸‹çš„å›¾ç‰‡ã€‚
ç‚¹å‡»åˆ—è¡¨ï¼Œå³ä¾§æ˜¾ç¤ºå½“æ—¶çš„æˆªå›¾ + AI çš„ JSON å“åº”ï¼ˆåˆ†æç»“æœï¼‰ã€‚
ä»·å€¼ï¼šå½“ AI çŠ¯é”™æ—¶ï¼Œä½ å¯ä»¥ç›´æ¥çœ‹è¿™å¼ å›¾ï¼ŒçŸ¥é“æ˜¯ OCR æ²¡è¯†åˆ«å‡†ï¼Œè¿˜æ˜¯å¤§æ¨¡å‹å¹»è§‰äº†ã€‚
4. è™šæ‹Ÿå±å¹•çŠ¶æ€ç›‘æ§
åˆ©ç”¨ virtual_display.py çš„æ•°æ®ã€‚
åŠŸèƒ½ï¼šåœ¨çŠ¶æ€æ æ˜¾ç¤ºä¸€ä¸ªå°å›¾æ ‡ã€‚
ğŸ–¥ï¸ ä¸»å±æ¨¡å¼ï¼šå›¾æ ‡ç°è‰²ã€‚
ğŸ“º è™šæ‹Ÿå±æ¨¡å¼ï¼šå›¾æ ‡äº®èµ·ï¼Œå¹¶æ˜¾ç¤ºè™šæ‹Ÿå±åˆ†è¾¨ç‡ï¼ˆå¦‚ 1920x1080ï¼‰ã€‚
ä¸€é”®åˆ‡æ¢ï¼šåŠ ä¸€ä¸ªæŒ‰é’®ï¼Œè°ƒç”¨ bg_windows.move_game_to_virtual_screen(hwnd)ã€‚
ğŸ’» ä»£ç è½åœ°ï¼šUI æ¡†æ¶ä»£ç  (Main.py)
è¿™æ˜¯åŸºäº CustomTkinter ä¸ºä½ é‡å†™çš„å…¥å£ä»£ç æ¡†æ¶ï¼Œç›´æ¥æ•´åˆäº†ä½ çš„ agent_console é€»è¾‘ï¼š
code
Python
import customtkinter as ctk
import threading
import queue
import time
from PIL import Image
from datetime import datetime

# å¼•å…¥ä½ çš„æ ¸å¿ƒæ¨¡å—
# from smart_agent import SmartAgent
# from background_windows import BackgroundWindows
# ... (å¼•å…¥å…¶ä»–æ¨¡å—)

ctk.set_appearance_mode("Dark")
ctk.set_default_color_theme("blue")

class AICmdCenter(ctk.CTk):
    def __init__(self):
        super().__init__()
        
        # --- çª—å£åŸºç¡€è®¾ç½® ---
        self.title("AI Agent æŒ‡æŒ¥ä¸­å¿ƒ - Project Daigan")
        self.geometry("1280x800")
        
        # --- æ•°æ®é€šä¿¡ ---
        self.log_queue = queue.Queue()
        self.image_queue = queue.Queue()
        self.agent_running = False
        
        # --- å¸ƒå±€åˆå§‹åŒ– ---
        self.grid_columnconfigure(1, weight=1)
        self.grid_rowconfigure(0, weight=1)
        
        self.init_sidebar()
        self.init_main_area()
        
        # --- å¯åŠ¨ UI æ›´æ–°å¾ªç¯ ---
        self.after(100, self.update_ui_loop)

    def init_sidebar(self):
        """å·¦ä¾§æ§åˆ¶æ """
        self.sidebar = ctk.CTkFrame(self, width=220, corner_radius=0)
        self.sidebar.grid(row=0, column=0, sticky="nsew")
        
        # æ ‡é¢˜
        self.logo_label = ctk.CTkLabel(self.sidebar, text="ğŸ¤– AI COMMANDER", font=ctk.CTkFont(size=20, weight="bold"))
        self.logo_label.pack(padx=20, pady=(20, 10))
        
        # çŠ¶æ€æŒ‡ç¤º
        self.status_label = ctk.CTkLabel(self.sidebar, text="â— IDLE", text_color="gray", font=("Consolas", 14))
        self.status_label.pack(pady=5)
        
        # æ§åˆ¶æŒ‰é’®
        self.btn_start = ctk.CTkButton(self.sidebar, text="å¯åŠ¨ Agent", fg_color="#2EA043", command=self.start_agent)
        self.btn_start.pack(padx=20, pady=10)
        
        self.btn_stop = ctk.CTkButton(self.sidebar, text="ç´§æ€¥åœæ­¢ (F12)", fg_color="#DA3633", command=self.stop_agent)
        self.btn_stop.pack(padx=20, pady=10)
        
        # æ¨¡å¼åˆ‡æ¢
        self.tab_view = ctk.CTkTabview(self.sidebar, height=300)
        self.tab_view.pack(padx=10, pady=20, fill="x")
        self.tab_view.add("ç›‘æ§")
        self.tab_view.add("è®¾ç½®")
        
        # ç›‘æ§Tabå†…çš„å¿«æ·æŒ‡ä»¤
        self.btn_quick1 = ctk.CTkButton(self.tab_view.tab("ç›‘æ§"), text="æµ‹è¯•æˆªå›¾", command=self.test_snapshot)
        self.btn_quick1.pack(pady=5)

    def init_main_area(self):
        """å³ä¾§ä¸»å†…å®¹åŒº"""
        self.main_frame = ctk.CTkFrame(self, fg_color="transparent")
        self.main_frame.grid(row=0, column=1, sticky="nsew", padx=20, pady=20)
        self.main_frame.grid_columnconfigure(0, weight=3) # ç”»é¢å 3ä»½
        self.main_frame.grid_columnconfigure(1, weight=2) # æ—¥å¿—å 2ä»½
        self.main_frame.grid_rowconfigure(0, weight=1)
        
        # 1. è§†è§‰é¢„è§ˆåŒº (The Eye)
        self.preview_frame = ctk.CTkFrame(self.main_frame)
        self.preview_frame.grid(row=0, column=0, sticky="nsew", padx=(0, 10))
        
        self.preview_label = ctk.CTkLabel(self.preview_frame, text="ç­‰å¾…è§†è§‰ä¿¡å·...", corner_radius=10)
        self.preview_label.pack(expand=True, fill="both", padx=10, pady=10)
        
        # 2. æ€ç»´é“¾æ—¥å¿—åŒº (The Mind)
        self.log_frame = ctk.CTkScrollableFrame(self.main_frame, label_text="æ€ç»´é“¾æ—¥å¿— (CoT)")
        self.log_frame.grid(row=0, column=1, sticky="nsew")

    def add_log_card(self, text, type="info"):
        """æ·»åŠ å¡ç‰‡å¼æ—¥å¿—"""
        colors = {
            "thought": ("#1c2e4a", "#3b8ed0"), # æ·±è“èƒŒæ™¯
            "action":  ("#1e3a29", "#2cc985"), # æ·±ç»¿èƒŒæ™¯
            "error":   ("#4a1c1c", "#fa5a5a"), # æ·±çº¢èƒŒæ™¯
            "info":    ("gray20", "gray80")
        }
        bg, fg = colors.get(type, colors["info"])
        
        card = ctk.CTkFrame(self.log_frame, fg_color=bg)
        card.pack(fill="x", pady=2, padx=5)
        
        ts = datetime.now().strftime("%H:%M:%S")
        
        # æ ‡é¢˜è¡Œ
        header = ctk.CTkLabel(card, text=f"[{ts}] {type.upper()}", text_color=fg, font=("Arial", 10, "bold"), anchor="w")
        header.pack(fill="x", padx=5, pady=(5,0))
        
        # å†…å®¹è¡Œ
        content = ctk.CTkLabel(card, text=text, text_color="white", font=("Consolas", 12), justify="left", anchor="w", wraplength=300)
        content.pack(fill="x", padx=5, pady=(0,5))
        
        # è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
        self.log_frame._parent_canvas.yview_moveto(1.0)

    def update_image_preview(self, pil_image):
        """æ›´æ–°è§†è§‰é¢„è§ˆï¼Œå¤„ç†å›¾ç‰‡å°ºå¯¸é€‚é…"""
        # è®¡ç®—ç¼©æ”¾
        w_box = self.preview_frame.winfo_width()
        h_box = self.preview_frame.winfo_height()
        
        # ç®€å•çš„ä¿æŒæ¯”ä¾‹ç¼©æ”¾é€»è¾‘ (æ­¤å¤„å¯ä¼˜åŒ–)
        ctk_img = ctk.CTkImage(light_image=pil_image, dark_image=pil_image, size=(w_box-20, h_box-20))
        self.preview_label.configure(image=ctk_img, text="")

    def update_ui_loop(self):
        """UI ä¸»å¾ªç¯ï¼Œå¤„ç†é˜Ÿåˆ—æ¶ˆæ¯"""
        # 1. å¤„ç†æ—¥å¿—
        try:
            while True:
                msg = self.log_queue.get_nowait()
                self.add_log_card(msg['text'], msg['type'])
        except queue.Empty:
            pass
        
        # 2. å¤„ç†å›¾åƒ
        try:
            while True:
                # åªå–æœ€æ–°çš„ä¸€å¼ å›¾ï¼Œä¸¢å¼ƒæ—§çš„ä»¥é˜²å¡é¡¿
                img = self.image_queue.get_nowait()
                if self.image_queue.empty():
                    self.update_image_preview(img)
        except queue.Empty:
            pass
            
        self.after(100, self.update_ui_loop)

    # --- æ¨¡æ‹Ÿä¸šåŠ¡é€»è¾‘è¿æ¥ ---
    def start_agent(self):
        self.status_label.configure(text="â— RUNNING", text_color="#2cc985")
        self.log_queue.put({"text": "Agent å¯åŠ¨åˆå§‹åŒ–...", "type": "info"})
        # è¿™é‡Œå¯åŠ¨ä½ çš„ agent_core çº¿ç¨‹
        
    def stop_agent(self):
        self.status_label.configure(text="â— STOPPED", text_color="#fa5a5a")
        self.log_queue.put({"text": "ç”¨æˆ·è§¦å‘ç´§æ€¥åœæ­¢", "type": "error"})

    def test_snapshot(self):
        """æµ‹è¯•ç”¨ï¼šæ¨¡æ‹Ÿå‘é€ä¸€å¼ å›¾ç‰‡"""
        # å®é™…ä»£ç ä¸­ï¼Œä½ åº”è¯¥åœ¨ SmartAgent.step é‡Œè°ƒç”¨ queue.put
        self.log_queue.put({"text": "æ­£åœ¨è·å–å±å¹•æˆªå›¾...", "type": "thought"})
        self.log_queue.put({"text": "è¯†åˆ«åˆ°ç›®æ ‡ï¼š'å¼€å§‹æ¸¸æˆ' (0.85)", "type": "action"})
        
        # æ¨¡æ‹Ÿç”Ÿæˆä¸€å¼ çº¢å›¾
        img = Image.new('RGB', (800, 450), color = (73, 109, 137))
        self.image_queue.put(img)

if __name__ == "__main__":
    app = AICmdCenter()
    app.mainloop()
ğŸš€ å¦‚ä½•ä¿®æ”¹ç°æœ‰ä»£ç ä»¥é€‚é…æ–° UI
ä½ éœ€è¦å¯¹ smart_agent.py åšå¾®å°çš„æ”¹åŠ¨ï¼Œè®©å®ƒæ”¯æŒå›è°ƒæˆ–é˜Ÿåˆ—ä¼ è¾“ï¼š
ä¿®æ”¹ SmartAgent.__init__:
code
Python
def __init__(self, bg_windows, ai_brain, ui_queue=None, img_queue=None):
    # ... åŸæœ‰ä»£ç  ...
    self.ui_queue = ui_queue
    self.img_queue = img_queue
ä¿®æ”¹ SmartAgent.step:
code
Python
# åœ¨æˆªå›¾å
if self.img_queue:
    # å¦‚æœæœ‰ç½‘æ ¼ç»˜åˆ¶é€»è¾‘ï¼Œè¿™é‡Œæœ€å¥½ä¼ å…¥ç”»å¥½ç½‘æ ¼çš„å›¾
    annotated_img = self.ai_brain._add_grid_overlay(screenshot.copy()) 
    self.img_queue.put(annotated_img)

# åœ¨ AI æ€è€ƒå
if self.ui_queue:
    self.ui_queue.put({"text": f"AI åˆ†æ: {result.get('analysis')}", "type": "thought"})
    self.ui_queue.put({"text": f"æ‰§è¡Œæ“ä½œ: {action}", "type": "action"})
ğŸŒŸ æ€»ç»“
ç›®å‰çš„æ–¹æ¡ˆæ˜¯â€œèƒ½ç”¨â€ï¼Œè€ŒåŸºäº CustomTkinter çš„æ–°æ–¹æ¡ˆæ˜¯â€œå¥½ç”¨ä¸”æ˜“è°ƒè¯•â€ã€‚
å¯¹äºä¸€ä¸ª AI é¡¹ç›®ï¼Œâ€œçœ‹åˆ° AI æ€ä¹ˆæƒ³â€æ¯”â€œè®© AI ç›²è·‘â€é‡è¦å¾—å¤šã€‚æˆ‘å¼ºçƒˆå»ºè®®ä½ é‡‡ç”¨è¿™ä¸ªæ–°çš„ UI æ¶æ„ï¼Œå®ƒèƒ½è®©ä½ çš„ vision_core å’Œ doubao_brain çš„å¼ºå¤§èƒ½åŠ›çœŸæ­£å±•ç°åœ¨ç”¨æˆ·é¢å‰ï¼Œè€Œä¸æ˜¯åŸ‹æ²¡åœ¨æ—¥å¿—æ–‡ä»¶é‡Œã€‚